@model SocialBookmarkApp.Models.Bookmark

<br />

<h2 class="text-center">@Model.Title</h2>

<br />

@if (ViewBag.Message != null)
{
    <div class="alert @ViewBag.Alert text-center">
        @ViewBag.Message
    </div>
}

<div class="card p-3 mb-3">
    <p><b>Descriere:</b> @Model.Description</p>

    @if (!string.IsNullOrEmpty(Model.MediaContent))
    {
        <p><b>Media:</b></p>
        <div>@Html.Raw(Model.MediaContent)</div>
    }

    <div>
        <div><i class="bi bi-person"></i> @Model.User.UserName</div>
        <div><i class="bi bi-clock-fill"></i> @Model.CreatedAt.ToLocalTime() </div>
    </div>

    <div>
        <div><i class="bi bi-globe"></i> @(Model.IsPublic ? "Public" : "Privat")  </div>
    </div>
    
    <div class="mb-3">
        <i class="bi bi-heart-fill text-danger"></i>
        <strong>@Model.VotesCount</strong> voturi
    </div>
    <form asp-controller="Vote" asp-action="Toggle" method="post">
        <input type="hidden" name="bookmarkId" value="@Model.Id" />

        <button class="btn @(ViewBag.UserHasLiked ? "btn-danger" : "btn-outline-danger")">
            <i class="bi @(ViewBag.UserHasLiked ? "bi-heart-fill" : "bi-heart")"></i>
            @Model.VotesCount
        </button>
    </form>
</div>

@if (Model.BookmarkCategories != null && Model.BookmarkCategories.Any())
{
    <div class="mb-3">
        <b>Categorii:</b>
        <ul>
            @foreach (var bc in Model.BookmarkCategories)
            {
                <li>@bc.Category?.CategoryName</li>
            }
        </ul>
    </div>
}

<hr />

<h4>Comentarii</h4>

@if (Model.Comments != null && Model.Comments.Any())
{
    @foreach (var comm in Model.Comments)
    {
        <div class="border p-2 mb-2">
            <p>@comm.Content</p>
            <small>
                @comm.User?.UserName â€“
                @comm.CreatedAt.ToLocalTime()
            </small>

            @if (comm.UserId == ViewBag.UserCurent)
            {
                <div class="mt-2">
                    <a class="btn btn-sm btn-warning"
                       asp-controller="Comment"
                       asp-action="Edit"
                       asp-route-id="@comm.Id">
                        Editeaza
                    </a>

                    <form asp-controller="Comment"
                          asp-action="Delete"
                          asp-route-id="@comm.Id"
                          method="post"
                          style="display:inline">

                        <button class="btn btn-sm btn-danger"
                                onclick="return confirm('Sigur vrei sa stergi comentariul?');">
                            Sterge
                        </button>
                    </form>
                </div>
            }
        </div>
    }
    
}
else
{
    <p>Nu exista comentarii.</p>
}

<hr />

@if (User.Identity?.IsAuthenticated ?? false)
{
    <form asp-action="New" asp-controller="Comment" method="post">
        <input type="hidden" name="BookmarkId" value="@Model.Id" />

        <textarea name="Content" class="form-control"></textarea>

        <button class="btn btn-primary mt-2">Adauga comentariu</button>
    </form>
}
@if (Model.UserId == ViewBag.UserCurent || ViewBag.EsteAdmin)
{
    <a class="btn btn-warning" asp-action="Edit" asp-route-id="@Model.Id">Editeaza</a>
}

<br />

@if (Model.UserId == ViewBag.UserCurent || ViewBag.EsteAdmin)
{
    <form asp-action="Delete"
          asp-controller="Bookmark"
          asp-route-id="@Model.Id"
          method="post"
          style="display:inline">

        <button type="submit"
                class="btn btn-danger"
                onclick="return confirm('Sigur vrei sa stergi acest bookmark?');">
            Sterge
        </button>
    </form>
}

<a class="btn btn-secondary" asp-action="Index">Inapoi</a>