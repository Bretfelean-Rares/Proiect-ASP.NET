@model SocialBookmarkApp.Models.Bookmark

<br />
<h2 class="text-center">Editare bookmark</h2>
<br />

<form asp-action="Edit" asp-controller="Bookmark" asp-route-id="@Model.Id" method="post" enctype="multipart/form-data">
    <div asp-validation-summary="All" class="text-danger"></div>

    <div class="mb-3">
        <label asp-for="Title" class="form-label"></label>
        <input asp-for="Title" class="form-control" />
        <span asp-validation-for="Title" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Description" class="form-label"></label>
        <textarea asp-for="Description" class="form-control"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>
    @if (!string.IsNullOrEmpty(Model.MediaContent))
    {
        @if (Model.MediaContent.EndsWith(".mp4") || Model.MediaContent.EndsWith(".mov"))
        {
            <video controls style="max-width:100%; max-height:250px;">
                <source src="@Model.MediaContent" type="video/mp4"/>
            </video>
        }
        else
        {
            <img src="@Model.MediaContent"
                 style="max-width:100%; max-height:250px; object-fit:contain;"
                 class="rounded"/>
        }

        <div class="form-check mt-2">
            <input class="form-check-input"
                   type="checkbox"
                   name="RemoveMedia"
                   value="true"
                   id="removeMedia">
            <label class="form-check-label" for="removeMedia">
                Șterge media
            </label>
        </div>
    }
    else
    {
    <div class="mb-3">
        <label class="form-label">Adaugă media nouă</label>
        <input type="file" name="MediaFile" id="mediaFile" class="form-control" />
        <div class="text-danger mt-2" id="fileErr"></div>

        <script>
          const MAX = 20 * 1024 * 1024; // 20MB
          const input = document.getElementById("mediaFile");
          const err = document.getElementById("fileErr");
          const form = input.closest("form");
        
          form.addEventListener("submit", (e) => {
            err.textContent = "";
            if (input.files && input.files.length > 0) {
              const f = input.files[0];
              if (f.size > MAX) {
                e.preventDefault();
                err.textContent = "Fișierul este prea mare. Dimensiunea maximă este 20 MB.";
              }
            }
          });
        </script>
    </div>
    }
    <div class="mb-3">
        <label class="form-label">Tag-uri (separate prin virgulă)</label>
        <input class="form-control" name="tags" value="@ViewBag.TagsText" />
        <small class="text-muted">Ex: rock, synthwave, concert</small>
    </div>
    <div class="form-check mb-3">
        <input asp-for="IsPublic" class="form-check-input" />
        <label asp-for="IsPublic" class="form-check-label"></label>
    </div>
    

    <button class="btn btn-primary" type="submit">Salveaza</button>
    <a class="btn btn-secondary" asp-action="Show" asp-route-id="@Model.Id">Renunta</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}